---
title: 宝塔 Nginx 安装 Brotli 压缩模块
tags:
  - 宝塔
categories:
  - 运维教程
date: 2023-04-29 00:00:00
---

> 

<!-- more -->

## 准备工作

1. 先卸载你现在使用的nginx，避免后面步骤出错；

2. 下载brotli并修改nginx安装脚本进行安装

## 文件下载
连接SSH并输入以下命令，已用注释标明作用。

注：#号注释不要输入到SSH内！

cd /www/server
 #进入宝塔服务的目录
git clone https://github.com/google/ngx_brotli.git
 #克隆ngx_brotli模块
cd ngx_brotli
 #进入ngx_brotli模块目录
git submodule update --init #更新子模块，此步骤不可省略。

## 修改安装脚本
注：请备份原脚本后在执行下面操作，若误删误改，可以从http://download.bt.cn/install/0/nginx.sh 重新下载

安装脚本目录/www/server/panel/install找nginx.sh（若按上文下载了整合包，只需在备份原脚本后替换原脚本即可，直接跳到安装Nginx即可）

编辑脚本，依然是找到

./configure --user=www --group=www --prefix=${Setup_Path} ${ENABLE_LUA}


在./configure后添加

--add-module=/www/server/ngx_brotli
最终效果

./configure --add-module=/www/server/ngx_brotli --user=www --group=www --prefix=${Setup_Path}


## 安装Nginx
你想要安装什么版本就在输入什么版本的版本号

注：Tengin的版本号是2.3.2，不是Tengine 2.3.2

sh /www/server/panel/install/nginx.sh install 2.3.2
等待安装结束，约5分钟，完毕后会提示

Starting nginx...  done

## 设置Brotli
brotli on;              #启用
brotli_comp_level 6;    #压缩等级，默认6，最高11，太高的压缩水平可能需要更多的CPU
brotli_buffers 16 8k;   #请求缓冲区的数量和大小
brotli_min_length 20;   #指定压缩数据的最小长度，只有大于或等于最小长度才会对其压缩。这里指定20字节
brotli_types text/plain application/javascript application/x-javascript text/javascript text/css application/xml text/html application/json image/svg application/font-woff application/vnd.ms-fontobject application/vnd.apple.mpegurl image/x-icon image/jpeg image/gif image/png image/bmp;   #指定允许进行压缩类型
brotli_static always;   #是否允许查找预处理好的、以.br结尾的压缩文件，可选值为on、off、always
brotli_window 512k;     #窗口值，默认值为512k
重启Nginx，完毕。

## 写在最后

实测6压缩率比Gzip的5压缩率18.9kB→15.4kb。

部分CDN不支持透传Header会导致源站不做压缩处理(包括Gzip)，源站开了压缩CDN就不要开了。