---
title: UPS 低电压时通过群晖实现 Ubuntu 自动关机
tags:
  - 群晖
categories:
  - 智慧生活
date: 2023-02-19 00:00:00
---

> 之前文章提到杜老师买了 UPS，该设备支持低电压通知，直接对接到群晖上，而服务器没有办法获取电池信息。恰好看到 obaby 的解决方案，这里整理一下，供有需要的小伙伴参考！

<!-- more -->

## 群晖设置



{% gallery %}
![](https://cdn.dusays.com/2023/02/557-1.jpg/1)
{% endgallery %}

## 工具配置

```
apt -y install nut
```

```
vim /etc/nut/nut.conf
```

```
MODE=netclient
```

```
vim /etc/nut/upsmon.conf
```
83
```
MONITOR ups@192.168.31.87 1 monuser secret slave
```

```
systemctl restart nut-client
```

```
systemctl enable nut-client
```

## 线路测试

```
root@dusays:~# upsc ups@192.168.31.87
Init SSL without certificate database
battery.charge: 100
battery.voltage: 13.50
battery.voltage.high: 13.00
battery.voltage.low: 10.40
battery.voltage.nominal: 12.0
device.type: ups
driver.name: blazer_usb
driver.parameter.pollinterval: 5
driver.parameter.port: auto
driver.parameter.synchronous: no
driver.version: DSM7-1-1-42930-workplus-version2-repack-42930-220712
driver.version.internal: 0.12
input.current.nominal: 4.0
input.frequency: 50.0
input.frequency.nominal: 50
input.voltage: 230.8
input.voltage.fault: 230.8
input.voltage.nominal: 220
output.voltage: 230.8
ups.beeper.status: enabled
ups.delay.shutdown: 30
ups.delay.start: 180
ups.load: 0
ups.productid: 5161
ups.status: OL
ups.type: offline / line interactive
ups.vendorid: 0665
```

## 关机脚本

https://h4ck.org.cn/2023/02/%e6%a0%91%e8%8e%93%e6%b4%be%e8%87%aa%e5%ae%9a%e4%b9%89%e5%85%b3%e6%9c%ba%e8%84%9a%e6%9c%ac%ef%bc%88nut%ef%bc%89/