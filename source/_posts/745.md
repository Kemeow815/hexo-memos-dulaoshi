---
title: 如何配置 Nginx 防止 CC 攻击
tags:
  - 攻击
categories:
  - 网络安全
date: 2024-09-06 00:00:00
---

> 

<!-- more -->

## 

## 限制请求速度

使用 `ngx_http_limit_req_module` 模块，可以通过 `limit_req_zone` 指令定义请求速率限制的区域，并使用 `limit_req` 指令在特定的 location 中应用这些限制。例如：

```
limit_req_zone $binary_remote_addr zone=one:10m rate=30r/m;
server {
  ...
  location /login.html {
    limit_req zone=one;
    ...
  }
}
```

这样设置可以限制每个客户端 IP 每分钟最多发起 30 个请求。

## 限制连接数

使用 `ngx_http_limit_conn_module` 模块，可以通过 `limit_conn_zone` 指令定义连接数限制的区域，并使用 `limit_conn` 指令在特定的 location 中应用这些限制。例如：

```
limit_conn_zone $binary_remote_addr zone=addr:10m;
server {
  ...
  location /store/ {
    limit_conn addr 10;
    ...
  }
}
```

这将限制每个客户端 IP 同时最多只能有 10 个连接 。

## 关闭慢连接

通过设置 `client_body_timeout` 和 `client_header_timeout` 指令来定义读取客户端请求的超时时间，可以关闭慢连接。例如：

```
server {
  client_body_timeout 5s;
  client_header_timeout 5s;
  ...
}
```

这样可以防止攻击者通过慢连接攻击耗尽服务器资源 。

## 设置 IP 黑名单和白名单

使用 `allow` 和 `deny` 指令可以控制特定 IP 地址或 IP 范围的访问权限。例如：

```
location / {
  allow 192.168.1.0/24;
  deny all;
  ...
}
```

这样可以允许特定 IP 段访问，而拒绝其他所有 IP 访问 。

## 

集成 Fail2Ban 工具，可以对日志文件进行自动化监控，一旦检测到异常行为或恶意 IP 地址，立即将其加入黑名单并封锁 。

定制化的错误页面不仅能提升用户体验，还能在遭遇攻击时减少攻击者获取的有用信息 。

持续关注 Nginx 的错误日志，借助日志分析工具，及时发现并响应任何异常行为或攻击迹象 。

强制所有数据传输通过 HTTPS 加密，可以有效抵御中间人攻击和数据泄露风险 。

## 限制文件类型和请求大小

通过 `client_max_body_size` 指令限制上传文件的大小和类型，以及请求的大小，防止因大文件上传或超大数据包导致的服务中断或资源耗尽 。