---
title: DDoS 的攻击鉴赏上篇
tags:
  - 攻击
categories:
  - 网络安全
date: 2023-09-20 00:00:00
---

> 

<!-- more -->

## 

每个励志成为传奇黑客的年轻人

都要面临一个Hello World

而每个所谓安全的网络系统

最终都有一个不安全的隐患

恰巧他们都是同一个东西

DDoS

作为一个历史悠久的网络攻击手段

DDoS攻击的手法暴力且直接

但破坏力惊人

也缺乏彻底的根治方法

人们在它的身上吃尽了苦头

而在现代网络战争中

DDoS往往作为一场有规模有组织的

黑客攻击行动的佯攻手段

在DDoS洪水的掩护之下

伺机而入万军之中取上将首级

那么DDoS攻击为何在各种黑客技术的起起伏伏

攻伐思路的来来去去之间

能如此恒久远的涌流传下去

至今仍为网络安全的一个心头大患呢

我们不妨来赏析一下

DDoS攻击的技术细节



1996年9月6日美国纽约

著名的互联网服务商Panix的服务器

受到每秒高达150次的异常连接攻击

导致服务器疲於应对这些非法流量

而拒绝了正常用户的合法请求

这是目前大家比较认可的

历史上第一次DDoS攻击

DOS拒绝服务

顾名思义

即通过占用网络资源让它应接不暇

从而拒绝正常业务流量的一种网络攻击方式

而我们所说的DDoS

则是DOS攻击的分布式版本

俗称群殴

单台设备的攻击能力有限

治理起来也比较容易

但是当几十几百甚至成千上万个设备

组成一个网络

同时对目标发起DOS攻击时

无异于一场灾难

故而大家一般用DDoS

只带一般意义的拒绝服务攻击

而发起攻击的网络一般称之为

僵尸网络

每个僵尸可以是一台个人电脑

可以是一台服务器

甚至可以是一部智能手机

而为了得到这样的一个僵尸网络

则是八仙过海各显神通

或因为穷

或因为技术过硬的人士

利用木马

蠕虫

后门等恶意程序

感染大量的设备

形成僵尸网络

而富人则比较轻松

通过某些渠道直接花钱就可以购买到

理论上你花的钱越多

得到的僵尸网络规模就越大

攻击力就越强

1999年8月17日

美国明尼苏达大学的服务器

在至少200多台设备的DDoS攻击下

服务被迫中止了两天

而这200多台发起攻击的设备

都是在不知情的情况下被感染

而成为了僵尸网络中的一员

在通过IP追踪

并让设备停止攻击之后

问题还是未能完全解决

因为不断的有新的攻击设备加入进来

DDoS攻击

和其他利用程序漏洞攻击的阴谋不同

这种直接粗暴的方式算是一种阳谋

大家都知道是怎么发生的

但又无可奈何

直到今天DDoS问题都没有

也无法被完全解决



为了了解DDoS攻击手段的巧妙

我们需要先了解一点

互联网的工作方式

一次网络访问的过程

简化来看是这样的

客户端通过网络线路

向远程服务器请求内容

服务器按照客户端的需求

或查询或计算出相应的数据

再通过网络线路反送给客户端

这个数据在两端流转的行为

和传统的邮递过程是反向向

传统的邮递依靠的是邮政系统

而现代互联网中数据的流转

则依靠的是以TCP/IP协议

为核心的通信系统

TCP/IP的参考模型是一个四层结构

我们可以借助传统的邮递系统

对此做个模拟



写信的时候

大家一般会遵从约定的格式

比如先写对方的称呼

加官报号换行再写正文

结尾写上此至敬明

最后写上署名和日期

这类似于四层结构中的应用层

规定了一些数据内容的协议规则

比如我们上网时常用的HTTP协议

就属于这一层

写完信以后

我们可以做一个标记

比如粘上一根鸡毛

或盖上一个红搓

对方会根据这些标记

决定如何回复

要不要加急

要不要确认一下对方的身份等等

这类似于四层结构中的传输层

规定了数据的传输方式

比如这一层中

大家都熟悉的TCP协议

为了保证通信的可靠性

需要先经历三次握手

再发起数据传输

实际上对于一次可靠的通信过程

事先的沟通是很必要的

这在日常生活中很常见

我们以电视剧《三国演义》中

孙策第一次遇见太史慈这个场景举例

为了保证打架前没有搞错对象

孙策和太史慈反复确认了

对方的身份之后

才开始动手

TCP协议用三次握手做到了这一点

换句话说

在正式写信说正事之前

先发送三封确定彼此的信

建立一种可靠的连接

第一次

在TCP协议的信件上

有几个关键的字段

发起TCP连接时

我方先把SYN设置为1

ACK设置为0

再选择一个顺序号X

然后发送出去

第二次

对方收到之后回复一封信

把SYN设置为1

ACK设置为1

确认号设置为X+1

同时也选择一个顺序号Y

第三次

我方收到回信之后

把SYN设置为0

ACK设置为1

确认号设置为Y+1

顺序号设置为X+1

再次发送出去

如此一个TCP连接就建立起来了

接下来就可以发送用户的数据了

因为有三次握手的存在

通信要更加可靠

类似即时通信这样的软件

多采用TCP协议

在客户端和服务器之间

建立一个连接的信道

而这一层中

还有一个著名的UDP协议

它没有那么麻烦

不需要反复握手建立连接

直接把数据投递出去

也不管对方有没有收到

所以这是一种不可靠的协议

而用来装信件的信封

类似于四层结构中的网络层

主要规定了通信双方地址的编码规则

这一层采用的是IP协议

所以大家经常会听到所谓的

设备IP地址

而一封信的投递

最终依靠的是邮局

邮局把信件打包装车之后

根据收件地址

把信件投递到目的地

这一层对应着四层网络中的子网层

是信息传递的物理载体

比如以太网卫星网等等

这四层结构从应用层到子网层

数据按照不同的协议被不断的打包

到达目的地之后

刚好是相反的拆包过程

而最终被目标接收

可以看出来

其中最为核心的是互联网层中的IP协议

只要是按照IP协议封装的数据

都可以被发送

不论是以太网卫星网

还是其他物理实现的子网

正如你只要按照信封上的格式

写好收发地址

装入的信件就可以被投递到目的地

不论是走陆运空运还是海运

IP协议让不同的子网络被互联了起来

从这个通信过程中我们发现

从数据离开到最终到达

这一路几乎每个地方都有被DDoS攻击的机会

比如霸占服务器的网络带宽资源

我们只需要向一台服务器

发送大量的IP协议数据包

就可以慢慢的消耗掉对方的网络带宽

比如用大家耳熟能详的PING工具

就可以发起一次攻击

PIN产生的是ICMP协议包

ICMP是IP协议中用来进行插错控制的一个补充

本质上还是一个IP包

这种攻击方式也称之为ICMP洪水

这种攻击手段类似于

我们不断的给某个人投递信件

写了什么并不重要

重要的是让信件多的邮递员在对方的家门口

排起长队

从而打断正常的信件收发

同样的思路

我们还可以发送传输层的UDP协议包

发起一次UDP洪水攻击

当然这里会有一个问题

那就是会暴露攻击设备的IP地址

而被对方封禁

所以攻击者一般都会通过伪造IP地址来隐藏自己

比如张三给李四写信

却把发件地址写成了王武

这样即使是一封祖安问候信

李四也只能迁怒于王武

或者干脆写一个不存在的地址

让李四无处写份

但出于隐藏自己这个目的

人们发明了一种更有趣的攻击方式

反射攻击

既然可以伪造IP

那么就不必拘泥于伪造发件人的身份

同样可以伪造收件人的身份

达到借刀杀人的效果

我们把信封上的发件地址改为攻击目标的IP地址

然后把收件地址设置为互联网上大量的第三方机器

从而把数据发送到这些第三方机器上

这些机器在接收到数据之后

回复数据就会有用发件地址指向的攻击目标

这些第三方机器也被称之为反射器

这有点像把别人的电话号码挂在一些网站上

然后机主被不明真相的推销员给呼死

很损但很有效

反射攻击更难追踪来源

但更厉害的是

人们在此基础之上又发明了一种把攻击流量放大

以达到更强攻击效果的手段

放大攻击

比如DNS服务器是一种用来把域名解析为IP地址的设备

我们在浏览器中输入像dusays.com这样的域名地址

实际上需要先查询DNS服务器

获得这个域名对应的IP地址

再用IP地址访问杜老师说的服务器

同时DNS查询通常使用UDP这个不用验证来源的传输协议

综合来看DNS服务器就是一个很好的放大器

因为一次DNS的查询请求

返回数据往往大于请求的数据

这里有一个宽带放大因子BAF的概念

在DNS的查询中

一般60个字节的请求数据

可以获得将近3000个字节的返回数据

那么BAF就等于3000/60=50

产生50倍的放大效果

这样如果我们让攻击者不断的去对DNS服务器发起查询请求

并把原地址伪造成为攻击目标的IP

那么这样的反射攻击就会产生50倍的流量放大效果

可谓四两拨二十斤

除了对目标的宽带资源进行霸占

以达到DDoS攻击的效果以外

因为TCP协议中有连接的概念

所以还可以攻击服务器的连接资源