---
title: 基于 rsync+inotify 实现文件的实时同步
tags:
  - 
categories:
  - 
date: 2024-05-28 00:00:00
---

> 

<!-- more -->

## 1、安装rsync和inotify
yum install rsync inotify
2、服务器之间配置免密登录
2.1 生成密钥对
ssh-keygen
2.2 拷贝公钥到对方服务器
3、编辑同步脚本
ssh_port 替换为实际的ssh端口，如果是22可以去掉-e 'ssh -p $ssh_port'
local_path 替换为本地目录
remote_path 替换为远程服务器的目录
vi tongbu.sh

#!/bin/bash
while inotifywait -r -e modify,create /root/backup; do
  rsync -az -e 'ssh -p $ssh_port' --exclude '.*' $local_path root@172.1.1.1:$remote_path
done
chmod +x tongbu.sh
4、运行测试
nohup ./tongque.sh &
双向同步的话，需要上面的步骤在两台服务器上运行一次。 在任一台服务器上的同步目录下创建一个文件，再去目标服务器上查看目录中是否存在刚才的文件。

5、注意点
再实际测试中发现，如果该目录已经为同步的目录，从其他的地方cp或scp到该目录时，大文件会损坏，需要使用rsync -az 命令进行同步传输。